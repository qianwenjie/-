<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task 2 - 题型同义词识别测试</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .test-result {
      font-family: 'Courier New', monospace;
      background: #f3f4f6;
      padding: 12px;
      border-radius: 6px;
      margin-top: 8px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .test-case {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      background: white;
    }
    .pass {
      color: #10b981;
      font-weight: bold;
    }
    .fail {
      color: #ef4444;
      font-weight: bold;
    }
  </style>
</head>
<body class="bg-gray-50 p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Task 2 - 题型同义词识别测试</h1>
    <p class="text-gray-600 mb-6">自动测试SmartParamExtractor的题型识别功能</p>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">测试统计</h2>
      <div class="grid grid-cols-3 gap-4">
        <div class="text-center">
          <div class="text-3xl font-bold text-blue-600" id="totalTests">0</div>
          <div class="text-sm text-gray-600">总测试数</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-green-600" id="passedTests">0</div>
          <div class="text-sm text-gray-600">通过</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-red-600" id="failedTests">0</div>
          <div class="text-sm text-gray-600">失败</div>
        </div>
      </div>
    </div>

    <div class="mb-6">
      <button onclick="runAllTests()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
        运行所有测试
      </button>
      <button onclick="clearResults()" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium ml-2">
        清除结果
      </button>
    </div>

    <div id="testResults"></div>
  </div>

  <script>
    // 复制SmartParamExtractor类定义
    class SmartParamExtractor {
      constructor() {
        this.synonyms = {
          type: {
            'single': ['单选', '单选题', '选择题', '单项选择', '单选题目'],
            'multiple': ['多选', '多选题', '多项选择', '多选题目'],
            'judge': ['判断', '判断题', '对错题', '是非题'],
            'fill': ['填空', '填空题', '填写题'],
            'essay': ['简答', '简答题', '问答题', '主观题'],
            'all': ['所有', '全部', '所有题型', '全部题型', '混合', '随机题型', '各种题型', '任意题型']
          }
        };
        this.patterns = {};
      }

      // 提取题型
      extractType(input) {
        const lowerInput = input.toLowerCase();

        // 遍历所有题型及其同义词
        for (const [typeKey, synonymList] of Object.entries(this.synonyms.type)) {
          for (const synonym of synonymList) {
            if (lowerInput.includes(synonym)) {
              // 获取题型中文名
              const typeNames = {
                'single': '单选题',
                'multiple': '多选题',
                'judge': '判断题',
                'fill': '填空题',
                'essay': '简答题',
                'all': '所有题型'
              };

              return {
                value: typeKey,
                name: typeNames[typeKey],
                confidence: 1.0  // 精确匹配，高置信度
              };
            }
          }
        }

        return null;
      }

      // 主提取方法
      extract(input, context = {}) {
        const params = {};
        const confidence = {};
        const ambiguous = [];

        // 1. 题型识别
        const typeResult = this.extractType(input);
        if (typeResult) {
          params.type = typeResult.value;
          params.typeName = typeResult.name;
          confidence.type = typeResult.confidence;
        }

        return { params, confidence, ambiguous };
      }
    }

    // 测试用例
    const testCases = [
      {
        name: '测试1: 单选题识别',
        input: '我要生成单选题',
        expected: { type: 'single', typeName: '单选题', confidence: 1.0 }
      },
      {
        name: '测试2: 多选题识别',
        input: '生成10道多选',
        expected: { type: 'multiple', typeName: '多选题', confidence: 1.0 }
      },
      {
        name: '测试3: 判断题识别',
        input: '来点判断题',
        expected: { type: 'judge', typeName: '判断题', confidence: 1.0 }
      },
      {
        name: '测试4: 填空题识别',
        input: '需要填空题',
        expected: { type: 'fill', typeName: '填空题', confidence: 1.0 }
      },
      {
        name: '测试5: 简答题识别',
        input: '生成简答题',
        expected: { type: 'essay', typeName: '简答题', confidence: 1.0 }
      },
      {
        name: '测试6: 所有题型识别',
        input: '来点所有题型',
        expected: { type: 'all', typeName: '所有题型', confidence: 1.0 }
      },
      {
        name: '测试7: 同义词识别 - 单项选择',
        input: '生成单项选择',
        expected: { type: 'single', typeName: '单选题', confidence: 1.0 }
      },
      {
        name: '测试8: 同义词识别 - 对错题',
        input: '需要对错题',
        expected: { type: 'judge', typeName: '判断题', confidence: 1.0 }
      },
      {
        name: '测试9: 同义词识别 - 问答题',
        input: '生成问答题',
        expected: { type: 'essay', typeName: '简答题', confidence: 1.0 }
      },
      {
        name: '测试10: 无题型识别',
        input: '生成题目',
        expected: { type: null, typeName: null, confidence: null }
      },
      {
        name: '测试11: 同义词 - 选择题',
        input: '来点选择题',
        expected: { type: 'single', typeName: '单选题', confidence: 1.0 }
      },
      {
        name: '测试12: 同义词 - 是非题',
        input: '生成是非题',
        expected: { type: 'judge', typeName: '判断题', confidence: 1.0 }
      },
      {
        name: '测试13: 同义词 - 主观题',
        input: '需要主观题',
        expected: { type: 'essay', typeName: '简答题', confidence: 1.0 }
      },
      {
        name: '测试14: 同义词 - 随机题型',
        input: '生成随机题型',
        expected: { type: 'all', typeName: '所有题型', confidence: 1.0 }
      }
    ];

    let totalTests = 0;
    let passedTests = 0;
    let failedTests = 0;

    function runAllTests() {
      clearResults();
      const extractor = new SmartParamExtractor();
      const resultsContainer = document.getElementById('testResults');

      testCases.forEach((testCase, index) => {
        totalTests++;
        const result = extractor.extract(testCase.input);

        // 验证结果
        const passed = validateResult(result, testCase.expected);

        if (passed) {
          passedTests++;
        } else {
          failedTests++;
        }

        // 渲染测试结果
        const testDiv = document.createElement('div');
        testDiv.className = 'test-case';
        testDiv.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-lg font-semibold text-gray-900">${testCase.name}</h3>
            <span class="${passed ? 'pass' : 'fail'}">${passed ? '✓ 通过' : '✗ 失败'}</span>
          </div>
          <div class="mb-2">
            <span class="text-sm text-gray-600">输入:</span>
            <div class="text-sm text-gray-800 mt-1">"${testCase.input}"</div>
          </div>
          <div class="mb-2">
            <span class="text-sm text-gray-600">预期结果:</span>
            <div class="test-result text-xs">${JSON.stringify(testCase.expected, null, 2)}</div>
          </div>
          <div>
            <span class="text-sm text-gray-600">实际结果:</span>
            <div class="test-result text-xs">${JSON.stringify({
              type: result.params.type || null,
              typeName: result.params.typeName || null,
              confidence: result.confidence.type || null
            }, null, 2)}</div>
          </div>
        `;
        resultsContainer.appendChild(testDiv);
      });

      // 更新统计
      updateStats();
    }

    function validateResult(result, expected) {
      const actualType = result.params.type || null;
      const actualTypeName = result.params.typeName || null;
      const actualConfidence = result.confidence.type || null;

      return actualType === expected.type &&
             actualTypeName === expected.typeName &&
             actualConfidence === expected.confidence;
    }

    function updateStats() {
      document.getElementById('totalTests').textContent = totalTests;
      document.getElementById('passedTests').textContent = passedTests;
      document.getElementById('failedTests').textContent = failedTests;
    }

    function clearResults() {
      document.getElementById('testResults').innerHTML = '';
      totalTests = 0;
      passedTests = 0;
      failedTests = 0;
      updateStats();
    }

    // 页面加载时自动运行测试
    window.addEventListener('load', function() {
      console.log('页面加载完成,准备运行测试...');
      setTimeout(runAllTests, 500);
    });
  </script>
</body>
</html>
